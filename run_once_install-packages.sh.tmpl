#!/usr/bin/env bash

install_brew() {
    if !command -v brew &>/dev/null; then
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    fi
}

{{ if eq .chezmoi.username "ericcrosson" -}}
install_go_jira() {
    if !command -v jira &>/dev/null; then
        GO111MODULE=on go get github.com/go-jira/jira/cmd/jira
    fi
}
{{ end -}}

configure_keyboard_repeat_rate() {
{{ if eq .chezmoi.os "linux" -}}
    gsettings set org.gnome.desktop.peripherals.keyboard repeat-interval 12
    gsettings set org.gnome.desktop.peripherals.keyboard delay 172
{{ else if eq .chezmoi.os "darwin" -}}
    defaults write NSGlobalDomain KeyRepeat -int 1
    defaults write -g InitialKeyRepeat -int 13
{{ end -}}
}

cat > "${HOME}/.Brewfile" <<EOF
brew "awscli"
brew "bash"
brew "bat"
brew "curl"
brew "diff-so-fancy"
brew "direnv"
brew "fd"
brew "fzf"
brew "git"
brew "hub"
brew "ripgrep"
brew "ruby"
brew "wget"
brew "youtube-dl"
EOF

install_brew
brew bundle --global

{{ if eq .chezmoi.username "ericcrosson" -}}
install_go_jira
{{ end -}}

configure_keyboard_repeat_rate

{{ if eq .chezmoi.os "linux" }}

# DISCUSS: Hopefully this installs Hack, but if this script runs
# before provisioning then it won't be effective. Also not sure if
# flags -f -v are required
fc-cache

{{ else if eq .chezmoi.os "darwin" }}

brew cask install homebrew/cask-fonts/font-hack

brew install emacs-head@28 \
    --with-cocoa \
    --with-imagemagick \
    --with-no-frame-refocus \
    --with-pdumper \
    --with-xwidgets \
    --with-modern-icon-purple

{{ end }}
