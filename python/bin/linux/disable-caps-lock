#!/usr/bin/env python
# Eric Crosson
# 2015-08-31
#
# This script disables an active caps lock.
#
# Thanks to http://askubuntu.com/a/80301

import os
import sys
import argparse
from ctypes import *


def disable_caps_lock():
    """Turn caps lock off.

    This will have no effect if caps lock is already off.

    """
    X11 = cdll.LoadLibrary('libX11.so.6')
    display = X11.XOpenDisplay(None)
    X11.XkbLockModifiers(display, c_uint(0x0100), c_uint(2), c_uint(0))
    X11.XCloseDisplay(display)


def running_ubuntu():
    """Return true if the current OS is a version of Ubuntu."""
    return 'ubuntu' in os.uname().release


if __name__ == '__main__':
    argparse.ArgumentParser(description='Disable caps lock').parse_args()
    if not running_ubuntu():
        print('Only Ubuntu is currently supported')
        sys.exit(1)
    sys.exit(disable_caps_lock())
